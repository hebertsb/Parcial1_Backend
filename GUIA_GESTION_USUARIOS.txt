# GU√çA COMPLETA DE GESTI√ìN DE USUARIOS - PAYLOADS ACTUALIZADOS

**Versi√≥n**: 2.0 - Actualizada con modelos consolidados  
**Fecha**: 24 de septiembre de 2025  
**Modelos base**: `authz.models` (consolidados)

---

## üìã √çNDICE

1. [Registro de Propietarios](#registro-propietarios)
2. [Gesti√≥n de Familiares](#gestion-familiares)
3. [Registro de Inquilinos](#registro-inquilinos)
4. [Autenticaci√≥n](#autenticacion)
5. [Administraci√≥n de Solicitudes](#administracion-solicitudes)
6. [C√≥digos de Respuesta](#codigos-respuesta)

---

## üèòÔ∏è REGISTRO DE PROPIETARIOS

### 1. **Registro Inicial de Propietario**

**Endpoint**: `POST /api/authz/propietarios/solicitud/`  
**Descripci√≥n**: Registro inicial de un propietario con solicitud de aprobaci√≥n

#### **üì§ PAYLOAD DE ENV√çO**
```json
{
  "primer_nombre": "Juan Carlos",
  "primer_apellido": "Gonz√°lez",
  "cedula": "12345678",
  "fecha_nacimiento": "1985-03-15",
  "email": "juan.gonzalez@email.com",
  "telefono": "591-70123456",
  "numero_casa": "A-101",
  "password": "MiPassword123!",
  "confirm_password": "MiPassword123!",
  "genero": "M"
}
```

#### **üìã CAMPOS OBLIGATORIOS**
- `primer_nombre` (string, max 100) - Primer nombre
- `primer_apellido` (string, max 100) - Primer apellido  
- `cedula` (string, max 20) - C√©dula de identidad (√∫nica)
- `fecha_nacimiento` (date, YYYY-MM-DD) - Fecha de nacimiento
- `email` (email) - Correo electr√≥nico (√∫nico, ser√° el username)
- `telefono` (string, max 20) - Tel√©fono de contacto
- `numero_casa` (string, max 20) - N√∫mero de casa/departamento (debe existir)
- `password` (string, min 8) - Contrase√±a
- `confirm_password` (string, min 8) - Confirmaci√≥n de contrase√±a

#### **üìã CAMPOS OPCIONALES**
- `genero` (choice): "M" (Masculino), "F" (Femenino), "O" (Otro)

#### **‚úÖ RESPUESTA EXITOSA (201)**
```json
{
  "message": "Solicitud de registro creada exitosamente",
  "data": {
    "solicitud_id": 15,
    "token_seguimiento": "ABC123XY",
    "usuario_id": 42,
    "estado": "PENDIENTE",
    "numero_casa": "A-101",
    "email": "juan.gonzalez@email.com",
    "mensaje": "Su solicitud est√° pendiente de revisi√≥n. Guarde el token: ABC123XY"
  }
}
```

---

### 2. **Registro Completo de Propietario con Familiares**

**Endpoint**: `POST /api/authz/propietarios/solicitud/`  
**Descripci√≥n**: Registro completo incluyendo familiares y foto

#### **üì§ PAYLOAD COMPLETO**
```json
{
  "nombres": "Juan Carlos",
  "apellidos": "Gonz√°lez Mart√≠nez", 
  "documento_identidad": "12345678",
  "fecha_nacimiento": "1985-03-15",
  "email": "juan.gonzalez@email.com",
  "telefono": "591-70123456",
  "numero_casa": "A-101",
  "password": "MiPassword123!",
  "password_confirm": "MiPassword123!",
  "genero": "M",
  "foto_base64": "data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQ...",
  "acepta_terminos": true,
  "familiares": [
    {
      "nombres": "Mar√≠a Elena",
      "apellidos": "Rodr√≠guez",
      "documento_identidad": "87654321",
      "fecha_nacimiento": "1988-07-22",
      "telefono": "591-71234567",
      "email": "maria.rodriguez@email.com",
      "genero": "F",
      "parentesco": "conyugue",
      "autorizado_acceso": true,
      "puede_autorizar_visitas": false,
      "foto_base64": "data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQ..."
    },
    {
      "nombres": "Carlos Andr√©s",
      "apellidos": "Gonz√°lez Rodr√≠guez",
      "documento_identidad": "11223344",
      "fecha_nacimiento": "2010-12-05",
      "telefono": "",
      "email": "",
      "genero": "M",
      "parentesco": "hijo",
      "autorizado_acceso": true,
      "puede_autorizar_visitas": false
    }
  ]
}
```

#### **üìã CAMPOS DE FAMILIARES**

**Obligatorios por familiar:**
- `nombres`, `apellidos`, `documento_identidad`, `fecha_nacimiento`, `parentesco`

**Opcionales por familiar:**
- `telefono`, `email`, `genero`, `foto_base64`, `parentesco_descripcion`
- `autorizado_acceso` (default: true)
- `puede_autorizar_visitas` (default: false)

**Opciones de parentesco:**
```json
[
  "conyugue", "hijo", "padre", "hermano", "abuelo", "nieto", 
  "tio", "sobrino", "primo", "cu√±ado", "yerno_nuera", "suegro", "otro"
]
```

---

## üë®‚Äçüë©‚Äçüëß‚Äçüë¶ GESTI√ìN DE FAMILIARES

### 3. **Registrar Familiar Individual**

**Endpoint**: `POST /api/authz/propietarios/panel/familiares/`  
**Autenticaci√≥n**: Requerida (Bearer Token)

#### **üì§ PAYLOAD**
```json
{
  "persona": {
    "nombre": "Pedro Luis",
    "apellido": "Gonz√°lez",
    "documento_identidad": "55667788",
    "fecha_nacimiento": "2005-09-10",
    "telefono": "591-72345678",
    "email": "pedro.gonzalez@email.com",
    "genero": "M",
    "foto_base64": "data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQ..."
  },
  "parentesco": "hijo",
  "parentesco_descripcion": "",
  "autorizado_acceso": true,
  "puede_autorizar_visitas": false,
  "observaciones": "Menor de edad, vive con nosotros"
}
```

#### **‚úÖ RESPUESTA EXITOSA (201)**
```json
{
  "message": "Familiar registrado exitosamente",
  "data": {
    "id": 25,
    "persona": {
      "id": 78,
      "nombre": "Pedro Luis",
      "apellido": "Gonz√°lez",
      "documento_identidad": "55667788",
      "nombre_completo": "Pedro Luis Gonz√°lez"
    },
    "parentesco": "hijo",
    "autorizado_acceso": true,
    "puede_autorizar_visitas": false,
    "activo": true,
    "created_at": "2025-09-24T10:30:00Z"
  }
}
```

---

### 4. **Listar Familiares**

**Endpoint**: `GET /api/authz/propietarios/panel/familiares/`  
**Autenticaci√≥n**: Requerida

#### **‚úÖ RESPUESTA**
```json
{
  "count": 3,
  "results": [
    {
      "id": 25,
      "persona": {
        "id": 78,
        "nombre": "Pedro Luis",
        "apellido": "Gonz√°lez", 
        "documento_identidad": "55667788",
        "telefono": "591-72345678",
        "email": "pedro.gonzalez@email.com",
        "nombre_completo": "Pedro Luis Gonz√°lez"
      },
      "parentesco": "hijo",
      "parentesco_display": "Hijo/a",
      "autorizado_acceso": true,
      "puede_autorizar_visitas": false,
      "observaciones": "Menor de edad",
      "activo": true,
      "created_at": "2025-09-24T10:30:00Z"
    }
  ]
}
```

---

## üè† REGISTRO DE INQUILINOS

### 5. **Registrar Inquilino**

**Endpoint**: `POST /api/authz/propietarios/panel/inquilinos/`  
**Autenticaci√≥n**: Requerida (Propietario)

#### **üì§ PAYLOAD**
```json
{
  "persona": {
    "nombre": "Ana Isabel",
    "apellido": "Mendoza",
    "documento_identidad": "99887766",
    "fecha_nacimiento": "1990-04-18",
    "telefono": "591-73456789",
    "email": "ana.mendoza@email.com",
    "genero": "F"
  },
  "vivienda_id": 15,
  "fecha_inicio": "2025-10-01",
  "fecha_fin": "2026-09-30",
  "monto_alquiler": 1500.00,
  "observaciones": "Contrato por un a√±o, renovable"
}
```

#### **üìã CAMPOS OBLIGATORIOS**
- `persona.nombre`, `persona.apellido`, `persona.documento_identidad`
- `persona.fecha_nacimiento`, `persona.telefono`, `persona.email`
- `vivienda_id` (ID de la vivienda)
- `fecha_inicio` (fecha de inicio del contrato)
- `monto_alquiler` (monto mensual)

#### **üìã CAMPOS OPCIONALES**
- `fecha_fin` (si no se especifica, contrato indefinido)
- `observaciones`, `persona.genero`

#### **‚úÖ RESPUESTA EXITOSA (201)**
```json
{
  "message": "Inquilino registrado exitosamente",
  "data": {
    "relacion_id": 18,
    "inquilino": {
      "id": 89,
      "usuario_id": 67,
      "persona": {
        "nombre": "Ana Isabel",
        "apellido": "Mendoza",
        "documento_identidad": "99887766",
        "nombre_completo": "Ana Isabel Mendoza"
      }
    },
    "vivienda": {
      "id": 15,
      "numero_casa": "B-205",
      "bloque": "B"
    },
    "fecha_inicio": "2025-10-01",
    "fecha_fin": "2026-09-30",
    "monto_alquiler": "1500.00",
    "activo": true
  }
}
```

---

## üîê AUTENTICACI√ìN

### 6. **Login de Usuario**

**Endpoint**: `POST /api/authz/login/`

#### **üì§ PAYLOAD**
```json
{
  "email": "juan.gonzalez@email.com",
  "password": "MiPassword123!"
}
```

#### **‚úÖ RESPUESTA EXITOSA (200)**
```json
{
  "access": "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9...",
  "refresh": "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9...",
  "user": {
    "id": 42,
    "email": "juan.gonzalez@email.com",
    "estado": "ACTIVO",
    "persona": {
      "id": 78,
      "nombre": "Juan Carlos",
      "apellido": "Gonz√°lez",
      "documento_identidad": "12345678",
      "telefono": "591-70123456",
      "nombre_completo": "Juan Carlos Gonz√°lez"
    },
    "roles": [
      {
        "id": 3,
        "nombre": "Propietario",
        "descripcion": "Propietario de vivienda"
      }
    ]
  }
}
```

---

### 7. **Refresh Token**

**Endpoint**: `POST /api/authz/token/refresh/`

#### **üì§ PAYLOAD**
```json
{
  "refresh": "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9..."
}
```

#### **‚úÖ RESPUESTA EXITOSA (200)**
```json
{
  "access": "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9..."
}
```

---

## ‚öôÔ∏è ADMINISTRACI√ìN DE SOLICITUDES

### 8. **Consultar Estado de Solicitud**

**Endpoint**: `GET /api/authz/propietarios/solicitud/status/{token}/`  
**P√∫blico**: No requiere autenticaci√≥n

#### **‚úÖ RESPUESTA EXITOSA (200)**
```json
{
  "solicitud": {
    "id": 15,
    "token_seguimiento": "ABC123XY",
    "estado": "PENDIENTE",
    "nombres": "Juan Carlos",
    "apellidos": "Gonz√°lez",
    "email": "juan.gonzalez@email.com",
    "numero_casa": "A-101",
    "vivienda_validada": {
      "id": 25,
      "numero_casa": "A-101",
      "bloque": "A"
    },
    "created_at": "2025-09-24T09:00:00Z",
    "fecha_revision": null,
    "comentarios_admin": "",
    "motivo_rechazo": ""
  }
}
```

---

### 9. **Listar Solicitudes Pendientes (Admin)**

**Endpoint**: `GET /api/authz/propietarios/admin/solicitudes/`  
**Autenticaci√≥n**: Requerida (Admin)

#### **‚úÖ RESPUESTA EXITOSA (200)**
```json
{
  "count": 5,
  "results": [
    {
      "id": 15,
      "token_seguimiento": "ABC123XY",
      "estado": "PENDIENTE",
      "nombres": "Juan Carlos",
      "apellidos": "Gonz√°lez",
      "documento_identidad": "12345678",
      "email": "juan.gonzalez@email.com",
      "telefono": "591-70123456",
      "numero_casa": "A-101",
      "vivienda_validada": {
        "numero_casa": "A-101",
        "bloque": "A"
      },
      "created_at": "2025-09-24T09:00:00Z"
    }
  ]
}
```

---

### 10. **Aprobar Solicitud (Admin)**

**Endpoint**: `POST /api/authz/propietarios/admin/solicitudes/{id}/aprobar/`  
**Autenticaci√≥n**: Requerida (Admin)

#### **üì§ PAYLOAD**
```json
{
  "observaciones": "Documentaci√≥n completa y verificada. Aprobado para registro."
}
```

#### **‚úÖ RESPUESTA EXITOSA (200)**
```json
{
  "message": "Solicitud aprobada exitosamente",
  "data": {
    "solicitud_id": 15,
    "usuario_creado": {
      "id": 42,
      "email": "juan.gonzalez@email.com",
      "estado": "ACTIVO"
    },
    "persona": {
      "id": 78,
      "nombre": "Juan Carlos",
      "apellido": "Gonz√°lez",
      "documento_identidad": "12345678"
    },
    "estado": "APROBADA",
    "fecha_revision": "2025-09-24T14:30:00Z"
  }
}
```

---

### 11. **Rechazar Solicitud (Admin)**

**Endpoint**: `POST /api/authz/propietarios/admin/solicitudes/{id}/rechazar/`  
**Autenticaci√≥n**: Requerida (Admin)

#### **üì§ PAYLOAD**
```json
{
  "motivo_rechazo": "Documentaci√≥n incompleta. Faltan comprobantes de propiedad de la vivienda A-101."
}
```

#### **‚úÖ RESPUESTA EXITOSA (200)**
```json
{
  "message": "Solicitud rechazada",
  "data": {
    "solicitud_id": 15,
    "estado": "RECHAZADA",
    "motivo_rechazo": "Documentaci√≥n incompleta. Faltan comprobantes de propiedad de la vivienda A-101.",
    "fecha_rechazo": "2025-09-24T14:45:00Z"
  }
}
```

---

## üìä C√ìDIGOS DE RESPUESTA

### **C√≥digos de √âxito**
- `200 OK` - Operaci√≥n exitosa
- `201 Created` - Recurso creado exitosamente

### **C√≥digos de Error del Cliente**
- `400 Bad Request` - Datos de entrada inv√°lidos
- `401 Unauthorized` - No autenticado
- `403 Forbidden` - Sin permisos suficientes
- `404 Not Found` - Recurso no encontrado
- `409 Conflict` - Conflicto (ej: email ya existe)

### **C√≥digos de Error del Servidor**
- `500 Internal Server Error` - Error interno del servidor

---

## üö® EJEMPLOS DE ERRORES COMUNES

### **Error de Validaci√≥n (400)**
```json
{
  "error": "Datos de entrada inv√°lidos",
  "details": {
    "email": ["Este correo electr√≥nico ya est√° registrado."],
    "cedula": ["Esta c√©dula ya est√° registrada."],
    "password": ["La contrase√±a debe tener al menos 8 caracteres."]
  }
}
```

### **Error de Autenticaci√≥n (401)**
```json
{
  "error": "No autenticado",
  "message": "Token de acceso requerido"
}
```

### **Error de Permisos (403)**
```json
{
  "error": "Sin permisos",
  "message": "No tiene permisos para realizar esta acci√≥n"
}
```

### **Error de Recurso No Encontrado (404)**
```json
{
  "error": "No encontrado",
  "message": "No existe la vivienda A-999 en el sistema"
}
```

---

## üîß HEADERS REQUERIDOS

### **Para endpoints p√∫blicos:**
```javascript
{
  "Content-Type": "application/json"
}
```

### **Para endpoints autenticados:**
```javascript
{
  "Content-Type": "application/json",
  "Authorization": "Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9..."
}
```

---

## üìù EJEMPLOS EN JAVASCRIPT

### **Registro de Propietario**
```javascript
const registrarPropietario = async (datos) => {
  try {
    const response = await fetch('/api/authz/propietarios/solicitud/', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        primer_nombre: datos.nombre,
        primer_apellido: datos.apellido,
        cedula: datos.cedula,
        fecha_nacimiento: datos.fechaNacimiento,
        email: datos.email,
        telefono: datos.telefono,
        numero_casa: datos.numeroCasa,
        password: datos.password,
        confirm_password: datos.confirmPassword,
        genero: datos.genero
      })
    });
    
    const result = await response.json();
    
    if (response.ok) {
      console.log('Registro exitoso:', result);
      // Guardar token de seguimiento
      localStorage.setItem('tokenSeguimiento', result.data.token_seguimiento);
    } else {
      console.error('Error en registro:', result);
    }
  } catch (error) {
    console.error('Error de red:', error);
  }
};
```

### **Login**
```javascript
const login = async (email, password) => {
  try {
    const response = await fetch('/api/authz/login/', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({ email, password })
    });
    
    const result = await response.json();
    
    if (response.ok) {
      // Guardar tokens
      localStorage.setItem('accessToken', result.access);
      localStorage.setItem('refreshToken', result.refresh);
      console.log('Login exitoso:', result.user);
    } else {
      console.error('Error en login:', result);
    }
  } catch (error) {
    console.error('Error de red:', error);
  }
};
```

### **Registrar Familiar**
```javascript
const registrarFamiliar = async (datosPersona, datosRelacion) => {
  const token = localStorage.getItem('accessToken');
  
  try {
    const response = await fetch('/api/authz/propietarios/panel/familiares/', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${token}`
      },
      body: JSON.stringify({
        persona: {
          nombre: datosPersona.nombre,
          apellido: datosPersona.apellido,
          documento_identidad: datosPersona.cedula,
          fecha_nacimiento: datosPersona.fechaNacimiento,
          telefono: datosPersona.telefono,
          email: datosPersona.email,
          genero: datosPersona.genero
        },
        parentesco: datosRelacion.parentesco,
        autorizado_acceso: datosRelacion.autorizadoAcceso,
        puede_autorizar_visitas: datosRelacion.puedeAutorizarVisitas,
        observaciones: datosRelacion.observaciones
      })
    });
    
    const result = await response.json();
    
    if (response.ok) {
      console.log('Familiar registrado:', result);
    } else {
      console.error('Error:', result);
    }
  } catch (error) {
    console.error('Error de red:', error);
  }
};
```

---

## ‚úÖ RESUMEN DE ENDPOINTS

| M√©todo | Endpoint | Descripci√≥n | Auth |
|--------|----------|-------------|------|
| POST | `/api/authz/propietarios/solicitud/` | Registro de propietario | No |
| GET | `/api/authz/propietarios/solicitud/status/{token}/` | Estado de solicitud | No |
| POST | `/api/authz/login/` | Autenticaci√≥n | No |
| POST | `/api/authz/token/refresh/` | Refresh token | No |
| POST | `/api/authz/propietarios/panel/familiares/` | Registrar familiar | S√≠ |
| GET | `/api/authz/propietarios/panel/familiares/` | Listar familiares | S√≠ |
| POST | `/api/authz/propietarios/panel/inquilinos/` | Registrar inquilino | S√≠ |
| GET | `/api/authz/propietarios/admin/solicitudes/` | Listar solicitudes | Admin |
| POST | `/api/authz/propietarios/admin/solicitudes/{id}/aprobar/` | Aprobar solicitud | Admin |
| POST | `/api/authz/propietarios/admin/solicitudes/{id}/rechazar/` | Rechazar solicitud | Admin |

---

## üìö PAYLOADS ADICIONALES

### 12. **Actualizar Familiar**

**Endpoint**: `PUT /api/authz/propietarios/panel/familiares/{id}/`  
**Autenticaci√≥n**: Requerida

#### **üì§ PAYLOAD**
```json
{
  "parentesco": "hermano",
  "parentesco_descripcion": "",
  "autorizado_acceso": false,
  "puede_autorizar_visitas": false,
  "observaciones": "Acceso restringido temporalmente"
}
```

### 13. **Eliminar/Desactivar Familiar**

**Endpoint**: `DELETE /api/authz/propietarios/panel/familiares/{id}/`  
**Autenticaci√≥n**: Requerida

#### **‚úÖ RESPUESTA EXITOSA (204)**
```json
{
  "message": "Familiar desactivado exitosamente"
}
```

### 14. **Listar Inquilinos del Propietario**

**Endpoint**: `GET /api/authz/propietarios/panel/inquilinos/`  
**Autenticaci√≥n**: Requerida

#### **‚úÖ RESPUESTA EXITOSA (200)**
```json
{
  "count": 2,
  "results": [
    {
      "id": 18,
      "fecha_inicio": "2025-10-01",
      "fecha_fin": "2026-09-30",
      "activo": true,
      "monto_alquiler": "1500.00",
      "observaciones": "Contrato por un a√±o",
      "created_at": "2025-09-24T10:00:00Z",
      "inquilino_info": {
        "nombre": "Ana Isabel",
        "apellido": "Mendoza",
        "documento_identidad": "99887766",
        "telefono": "591-73456789",
        "email": "ana.mendoza@email.com"
      },
      "vivienda_info": {
        "numero_casa": "B-205",
        "bloque": "B",
        "tipo_vivienda": "Departamento"
      }
    }
  ]
}
```

### 15. **Finalizar Contrato de Inquilino**

**Endpoint**: `PATCH /api/authz/propietarios/panel/inquilinos/{id}/finalizar/`  
**Autenticaci√≥n**: Requerida

#### **üì§ PAYLOAD**
```json
{
  "fecha_fin": "2025-12-31",
  "motivo_finalizacion": "Finalizaci√≥n anticipada por acuerdo mutuo"
}
```

---

## üé≠ VALIDACIONES IMPORTANTES

### **Validaciones de Documento de Identidad**
- Debe ser √∫nico en todo el sistema
- Solo n√∫meros y letras permitidos
- Longitud m√≠nima: 5 caracteres
- Longitud m√°xima: 20 caracteres

### **Validaciones de Email**
- Formato v√°lido de email requerido
- √önico para usuarios (no puede repetirse)
- Personas pueden compartir email en casos especiales

### **Validaciones de Contrase√±a**
```json
{
  "requisitos": [
    "M√≠nimo 8 caracteres",
    "Al menos una letra may√∫scula",
    "Al menos una letra min√∫scula",
    "Al menos un n√∫mero",
    "Al menos un car√°cter especial (!@#$%^&*)"
  ]
}
```

### **Validaciones de Vivienda**
- El n√∫mero de casa debe existir en el sistema
- No puede tener otro propietario activo
- No puede tener solicitud pendiente/aprobada

---

## üîí MIDDLEWARE Y SEGURIDAD

### **Rate Limiting**
- Registro de propietarios: 5 intentos por hora por IP
- Login: 10 intentos por hora por IP
- APIs autenticadas: 1000 requests por hora por usuario

### **Validaci√≥n de Tokens JWT**
- Access token v√°lido por: 1 hora
- Refresh token v√°lido por: 7 d√≠as
- Renovaci√≥n autom√°tica a los 45 minutos

### **Permisos por Endpoint**
```json
{
  "publicos": [
    "POST /api/authz/propietarios/solicitud/",
    "GET /api/authz/propietarios/solicitud/status/{token}/",
    "POST /api/authz/login/",
    "POST /api/authz/token/refresh/"
  ],
  "propietario": [
    "POST /api/authz/propietarios/panel/familiares/",
    "GET /api/authz/propietarios/panel/familiares/",
    "POST /api/authz/propietarios/panel/inquilinos/",
    "GET /api/authz/propietarios/panel/inquilinos/"
  ],
  "admin": [
    "GET /api/authz/propietarios/admin/solicitudes/",
    "POST /api/authz/propietarios/admin/solicitudes/{id}/aprobar/",
    "POST /api/authz/propietarios/admin/solicitudes/{id}/rechazar/"
  ]
}
```

---

## üß™ TESTING CON POSTMAN

### **Colecci√≥n de Variables de Entorno**
```json
{
  "base_url": "http://localhost:8000",
  "access_token": "",
  "refresh_token": "",
  "user_id": "",
  "token_seguimiento": ""
}
```

### **Pre-request Script para Autenticaci√≥n**
```javascript
// Para endpoints autenticados
if (pm.environment.get("access_token")) {
    pm.request.headers.add({
        key: "Authorization",
        value: "Bearer " + pm.environment.get("access_token")
    });
}
```

### **Test Script para Guardar Tokens**
```javascript
// Despu√©s del login exitoso
if (pm.response.code === 200) {
    const response = pm.response.json();
    pm.environment.set("access_token", response.access);
    pm.environment.set("refresh_token", response.refresh);
    pm.environment.set("user_id", response.user.id);
}
```

---

## üêõ TROUBLESHOOTING COM√öN

### **Error: "Ya existe una persona con este documento"**
```json
{
  "error": "Datos de entrada inv√°lidos",
  "details": {
    "documento_identidad": ["Ya existe una persona registrada con este documento"]
  }
}
```
**Soluci√≥n**: Verificar si la persona ya est√° registrada o usar un documento diferente.

### **Error: "No existe la vivienda X en el sistema"**
```json
{
  "error": "Datos de entrada inv√°lidos", 
  "details": {
    "numero_casa": ["No existe la vivienda A-999 en el sistema"]
  }
}
```
**Soluci√≥n**: Verificar el n√∫mero de casa con la administraci√≥n.

### **Error: "Token JWT expirado"**
```json
{
  "error": "Token inv√°lido",
  "message": "Given token not valid for any token type"
}
```
**Soluci√≥n**: Usar el refresh token para obtener un nuevo access token.

### **Error: "La vivienda ya tiene un propietario registrado"**
```json
{
  "error": "Datos de entrada inv√°lidos",
  "details": {
    "numero_casa": ["La vivienda A-101 ya tiene un propietario registrado en el sistema."]
  }
}
```
**Soluci√≥n**: Verificar la disponibilidad de la vivienda con administraci√≥n.

---

## üì± EJEMPLOS PARA REACT/FRONTEND

### **Hook personalizado para autenticaci√≥n**
```javascript
import { useState, useEffect } from 'react';

const useAuth = () => {
  const [user, setUser] = useState(null);
  const [loading, setLoading] = useState(true);
  
  useEffect(() => {
    const token = localStorage.getItem('accessToken');
    if (token) {
      // Verificar token y obtener usuario
      fetchUserData(token);
    } else {
      setLoading(false);
    }
  }, []);
  
  const login = async (email, password) => {
    const response = await fetch('/api/authz/login/', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ email, password })
    });
    
    if (response.ok) {
      const data = await response.json();
      localStorage.setItem('accessToken', data.access);
      localStorage.setItem('refreshToken', data.refresh);
      setUser(data.user);
      return { success: true, user: data.user };
    } else {
      const error = await response.json();
      return { success: false, error };
    }
  };
  
  const logout = () => {
    localStorage.removeItem('accessToken');
    localStorage.removeItem('refreshToken');
    setUser(null);
  };
  
  return { user, loading, login, logout };
};
```

### **Componente de formulario de registro**
```jsx
import React, { useState } from 'react';

const RegistroPropietario = () => {
  const [formData, setFormData] = useState({
    primer_nombre: '',
    primer_apellido: '',
    cedula: '',
    fecha_nacimiento: '',
    email: '',
    telefono: '',
    numero_casa: '',
    password: '',
    confirm_password: '',
    genero: ''
  });
  
  const [errors, setErrors] = useState({});
  const [loading, setLoading] = useState(false);
  
  const handleSubmit = async (e) => {
    e.preventDefault();
    setLoading(true);
    setErrors({});
    
    try {
      const response = await fetch('/api/authz/propietarios/solicitud/', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(formData)
      });
      
      const result = await response.json();
      
      if (response.ok) {
        alert(`Registro exitoso! Token de seguimiento: ${result.data.token_seguimiento}`);
        // Redirigir o limpiar formulario
      } else {
        setErrors(result.details || {});
      }
    } catch (error) {
      console.error('Error:', error);
      alert('Error de conexi√≥n');
    } finally {
      setLoading(false);
    }
  };
  
  return (
    <form onSubmit={handleSubmit}>
      {/* Campos del formulario */}
      <div>
        <label>Primer Nombre:</label>
        <input
          type="text"
          value={formData.primer_nombre}
          onChange={(e) => setFormData({...formData, primer_nombre: e.target.value})}
          required
        />
        {errors.primer_nombre && <span className="error">{errors.primer_nombre[0]}</span>}
      </div>
      
      {/* M√°s campos... */}
      
      <button type="submit" disabled={loading}>
        {loading ? 'Enviando...' : 'Registrar'}
      </button>
    </form>
  );
};
```

---

**Fecha de actualizaci√≥n**: 24 de septiembre de 2025  
**Versi√≥n de modelos**: Consolidados en `authz`  
**Estado**: ‚úÖ Completo y verificado