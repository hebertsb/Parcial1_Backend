================================================================================
üåê GU√çA COMPLETA PARA PROBAR EL RECONOCIMIENTO FACIAL EN EL NAVEGADOR
================================================================================

üìã INSTRUCCIONES PASO A PASO PARA TESTING EN NAVEGADOR WEB

================================================================================
üöÄ PASO 1: PREPARAR EL ENTORNO
================================================================================

1. ‚úÖ VERIFICAR QUE EL BACKEND EST√â CORRIENDO:
   - Abrir PowerShell en: D:\UNIVERSIDAD_AUTONOMA_GABRIEL_RENE_MORENO\MATERIAS\Sistema_de_Informacion_II\1er_Parcial\backendParcial1
   - Ejecutar: python manage.py runserver
   - Verificar que aparezca: "Starting development server at http://127.0.0.1:8000/"

2. ‚úÖ VERIFICAR CONEXI√ìN B√ÅSICA:
   - Abrir navegador (Chrome/Edge/Firefox)
   - Ir a: http://127.0.0.1:8000/admin/
   - Si carga la p√°gina de admin de Django = ‚úÖ Backend OK

================================================================================
üîç PASO 2: PRUEBAS B√ÅSICAS DE CONEXI√ìN (CONSOLA DEL NAVEGADOR)
================================================================================

1. üì± ABRIR CONSOLA DEL NAVEGADOR:
   - Presionar F12 o Clic derecho ‚Üí Inspeccionar
   - Ir a la pesta√±a "Console" / "Consola"

2. üß™ TEST 1 - CONEXI√ìN BACKEND:
   
   Copiar y pegar en la consola:
   ```javascript
   // Test b√°sico de conexi√≥n backend (Opci√≥n 1: Admin Django)
   fetch('http://127.0.0.1:8000/admin/')
     .then(r => {
       console.log('‚úÖ Backend Status:', r.status);
       if (r.status === 200) {
         console.log('üéØ Backend Django funcionando correctamente!');
         console.log('üì° Django Admin p√°gina cargada');
       }
       return r.text();
     })
     .then(html => {
       if (html.includes('Django')) {
         console.log('‚úÖ Confirmado: Django est√° corriendo');
       }
     })
     .catch(e => {
       console.error('‚ùå Error conexi√≥n backend:', e);
       console.log('üí° Verificar que Django est√© corriendo');
     });
   ```

   **üÜï OPCI√ìN ALTERNATIVA - HEALTH CHECK API:**
   ```javascript
   // Test de conexi√≥n usando Health Check API (sin autenticaci√≥n)
   fetch('http://127.0.0.1:8000/api/seguridad/health/')
     .then(r => {
       console.log('üîç Health Check Status:', r.status);
       return r.json();
     })
     .then(data => {
       if (data.success) {
         console.log('‚úÖ Backend funcionando correctamente!');
         console.log('üì° Estado:', data.status);
         console.log('üïê Timestamp:', data.timestamp);
         console.log('üì¶ Versi√≥n:', data.version);
       }
     })
     .catch(e => {
       console.error('‚ùå Error conexi√≥n health check:', e);
       console.log('üí° Verificar que Django est√© corriendo');
     });
   ```

   RESULTADO ESPERADO:
   - ‚úÖ Backend Status: 200
   - üéØ Backend Django funcionando correctamente!
   - ‚úÖ Confirmado: Django est√° corriendo

3. üß™ TEST 2 - ENDPOINT RECONOCIMIENTO FACIAL:
   
   Copiar y pegar en la consola:
   ```javascript
   // Test del endpoint de reconocimiento facial
   fetch('http://127.0.0.1:8000/seguridad/reconocimiento-facial/', {
     method: 'POST',
     headers: {
       'Content-Type': 'application/json',
     },
     body: JSON.stringify({
       imagen: 'data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wBDAAYEBQYFBAYGBQYHBwYIChAKCgkJChQODwwQFxQYGBcUFhYaHSUfGhsjHBYWICwgIyYnKSopGR8tMC0oMCUoKSj/2wBDAQcHBwoIChMKChMoGhYaKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCj/wAARCAABAAEDASIAAhEBAxEB/8QAFQABAQAAAAAAAAAAAAAAAAAAAAv/xAAUEAEAAAAAAAAAAAAAAAAAAAAA/8QAFQEBAQAAAAAAAAAAAAAAAAAAAAX/xAAUEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwCdABmX/9k='
     })
   })
   .then(r => {
     console.log('üì° Endpoint Status:', r.status);
     if (r.status === 200) {
       console.log('‚úÖ Endpoint funcionando correctamente');
       console.log('üéØ Listo para recibir fotos reales');
     } else if (r.status === 400) {
       console.log('‚úÖ Endpoint existe (400 = imagen inv√°lida, normal)');
       console.log('üéØ Listo para recibir fotos reales');
     }
     return r.json();
   })
   .then(data => {
     console.log('üìã Response:', data);
   })
   .catch(e => console.error('‚ùå Error endpoint:', e));
   ```

   RESULTADO ESPERADO:
   - üì° Endpoint Status: 200 o 400
   - ‚úÖ Endpoint funcionando correctamente
   - üéØ Listo para recibir fotos reales

================================================================================
üñºÔ∏è PASO 3: PRUEBA CON IMAGEN REAL
================================================================================

1. üì∑ PREPARAR UNA IMAGEN:
   - Tener lista una foto en tu computadora
   - Preferiblemente una foto de rostro clara
   - Tama√±o menor a 5MB
   - Formato: JPG, PNG, WEBP

2. üß™ TEST 3 - CREAR Y PROBAR CON IMAGEN:
   
   Copiar y pegar en la consola:
   ```javascript
   // Funci√≥n para probar con imagen
   const probarReconocimientoFacial = () => {
     // Crear input de archivo
     const input = document.createElement('input');
     input.type = 'file';
     input.accept = 'image/*';
     
     input.onchange = (event) => {
       const archivo = event.target.files[0];
       if (!archivo) return;
       
       console.log('üìÇ Archivo seleccionado:', archivo.name);
       console.log('üìè Tama√±o:', (archivo.size / 1024 / 1024).toFixed(2), 'MB');
       
       // Crear FormData
       const formData = new FormData();
       formData.append('foto_verificacion', archivo);
       formData.append('umbral_confianza', '70.0');
       formData.append('buscar_en', 'propietarios');
       formData.append('usar_ia_real', 'false'); // Usar simulaci√≥n primero
       
       console.log('üöÄ Enviando request...');
       console.log('‚è±Ô∏è Esto puede tomar unos segundos...');
       
       // Hacer request
       fetch('http://127.0.0.1:8000/api/seguridad/verificacion-tiempo-real/', {
         method: 'POST',
         body: formData
       })
       .then(response => {
         console.log('üì° Status Code:', response.status);
         return response.json();
       })
       .then(data => {
         console.log('üéØ RESULTADO COMPLETO:', data);
         
         if (data.success) {
           if (data.verificacion.resultado === 'ACEPTADO') {
             console.log('‚úÖ ACCESO AUTORIZADO');
             console.log('üë§ Persona:', data.verificacion.persona_identificada.nombre_completo);
             console.log('üéØ Confianza:', data.verificacion.confianza.toFixed(1) + '%');
           } else {
             console.log('‚ùå ACCESO DENEGADO');
             console.log('üìä Confianza:', data.verificacion.confianza.toFixed(1) + '%');
           }
         } else {
           console.log('‚ö†Ô∏è ERROR:', data.error);
         }
       })
       .catch(error => {
         console.error('‚ùå Error en request:', error);
       });
     };
     
     // Abrir selector de archivos
     input.click();
   };
   
   // Ejecutar funci√≥n
   console.log('üìÇ Selecciona una imagen para probar...');
   probarReconocimientoFacial();
   ```

3. üìù QU√â HACER:
   - Ejecutar el c√≥digo de arriba
   - Se abrir√° un selector de archivos
   - Elegir una imagen (foto de rostro)
   - Esperar el resultado en la consola

================================================================================
üß™ PASO 4: PRUEBA CON IA REAL
================================================================================

Si la prueba anterior funcion√≥, probar con IA real:

```javascript
const probarConIA = () => {
  const input = document.createElement('input');
  input.type = 'file';
  input.accept = 'image/*';
  
  input.onchange = (event) => {
    const archivo = event.target.files[0];
    if (!archivo) return;
    
    const formData = new FormData();
    formData.append('foto_verificacion', archivo);
    formData.append('umbral_confianza', '70.0');
    formData.append('buscar_en', 'propietarios');
    formData.append('usar_ia_real', 'true'); // IA REAL
    
    console.log('ü§ñ Probando con IA REAL...');
    console.log('‚è±Ô∏è Esto tomar√° m√°s tiempo (hasta 30 segundos)...');
    
    const startTime = Date.now();
    
    fetch('http://127.0.0.1:8000/api/seguridad/verificacion-tiempo-real/', {
      method: 'POST',
      body: formData
    })
    .then(response => response.json())
    .then(data => {
      const tiempo = ((Date.now() - startTime) / 1000).toFixed(1);
      console.log('‚è±Ô∏è Tiempo total:', tiempo, 'segundos');
      console.log('ü§ñ RESULTADO CON IA:', data);
    })
    .catch(error => console.error('‚ùå Error IA:', error));
  };
  
  input.click();
};

// Ejecutar
probarConIA();
```

================================================================================
üìä PASO 5: INTERPRETAR RESULTADOS
================================================================================

üü¢ RESULTADO EXITOSO (ACCESO AUTORIZADO):
```json
{
  "success": true,
  "verificacion": {
    "resultado": "ACEPTADO",
    "persona_identificada": {
      "nombre_completo": "Luis Garc√≠a",
      "documento": "12345678",
      "unidad": "Apto 101",
      "tipo_residente": "Propietario"
    },
    "confianza": 85.7,
    "umbral_usado": "70.0"
  },
  "estadisticas": {
    "total_comparaciones": 10,
    "tiempo_procesamiento_ms": 2340.5
  }
}
```

üî¥ RESULTADO DENEGADO:
```json
{
  "success": true,
  "verificacion": {
    "resultado": "DENEGADO",
    "confianza": 45.2,
    "umbral_usado": "70.0"
  }
}
```

‚ùå ERROR:
```json
{
  "success": false,
  "error": "Descripci√≥n del error"
}
```

================================================================================
üîß SOLUCI√ìN A PROBLEMAS COMUNES
================================================================================

‚ùå ERROR: "Failed to fetch" o "Network Error"
üí° SOLUCI√ìN: 
   - Verificar que Django est√© corriendo
   - Usar exactamente http://127.0.0.1:8000 (no localhost)

‚ùå ERROR: "CORS policy"
üí° SOLUCI√ìN: 
   - El backend ya tiene CORS configurado
   - Verificar URL exacta del endpoint

‚ùå ERROR: "400 Bad Request"
üí° SOLUCI√ìN: 
   - Imagen muy grande (max 5MB)
   - Formato no v√°lido (usar JPG/PNG)

‚ùå ERROR: "Request timeout"
üí° SOLUCI√ìN: 
   - Normal con IA real (hasta 30 segundos)
   - Probar primero con simulaci√≥n

‚ùå ERROR: "401 Unauthorized" en dashboard
üí° SOLUCI√ìN: 
   - El endpoint /api/seguridad/dashboard/ requiere autenticaci√≥n
   - Usar /api/seguridad/health/ para verificar conexi√≥n (sin auth)
   - Si necesitas dashboard, primero hacer login con /authz/login/

================================================================================
üîê SOLUCI√ìN PARA ERROR 401 - AUTENTICACI√ìN
================================================================================

Si recibes **401 Unauthorized** en el dashboard, usa este c√≥digo:

üß™ **TEST: HEALTH CHECK SIN AUTENTICACI√ìN**
```javascript
// Verificar backend sin autenticaci√≥n
fetch('http://127.0.0.1:8000/api/seguridad/health/')
  .then(r => {
    console.log('üîç Health Status:', r.status);
    return r.json();
  })
  .then(data => {
    console.log('‚úÖ Backend OK:', data.message);
    console.log('üì° Status:', data.status);
    console.log('üïê Time:', data.timestamp);
  })
  .catch(e => console.error('‚ùå Error:', e));
```

üß™ **TEST: LOGIN Y DASHBOARD COMPLETO**
```javascript
// Funci√≥n para hacer login y acceder al dashboard
const loginYDashboard = async () => {
  try {
    // 1. Hacer login
    console.log('üîê Haciendo login...');
    const loginResponse = await fetch('http://127.0.0.1:8000/authz/login/', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        username: 'tu_usuario',  // ‚ö†Ô∏è CAMBIAR POR TU USUARIO
        password: 'tu_password'  // ‚ö†Ô∏è CAMBIAR POR TU PASSWORD
      })
    });

    if (loginResponse.ok) {
      const loginData = await loginResponse.json();
      console.log('‚úÖ Login exitoso');
      
      // 2. Usar el token para acceder al dashboard
      const token = loginData.access_token || loginData.access;
      console.log('üéüÔ∏è Token obtenido');
      
      const dashboardResponse = await fetch('http://127.0.0.1:8000/api/seguridad/dashboard/', {
        headers: {
          'Authorization': `Bearer ${token}`,
          'Content-Type': 'application/json'
        }
      });
      
      if (dashboardResponse.ok) {
        const dashboardData = await dashboardResponse.json();
        console.log('‚úÖ Dashboard accedido exitosamente');
        console.log('üìä Datos:', dashboardData);
      } else {
        console.log('‚ùå Error dashboard:', dashboardResponse.status);
      }
      
    } else {
      console.log('‚ùå Error login:', loginResponse.status);
      const errorData = await loginResponse.json();
      console.log('üîç Detalle error:', errorData);
    }
    
  } catch (error) {
    console.error('üí• Error completo:', error);
  }
};

// Ejecutar (cambiar usuario y password arriba)
loginYDashboard();
```

üß™ **TEST: VERIFICAR SOLO HEALTH CHECK**
```javascript
// Opci√≥n simple - solo verificar que backend funcione
const verificarBackend = () => {
  fetch('http://127.0.0.1:8000/api/seguridad/health/')
    .then(r => r.json())
    .then(data => {
      if (data.success) {
        console.log('‚úÖ BACKEND FUNCIONANDO');
        console.log('üéØ Mensaje:', data.message);
        console.log('üì° Estado:', data.status);
        console.log('‚è∞ Hora:', data.timestamp);
        
        // El backend est√° OK, ahora puedes usar reconocimiento facial
        console.log('üé≠ Reconocimiento facial disponible en:');
        console.log('   üì° /api/seguridad/verificacion-tiempo-real/');
      }
    })
    .catch(e => {
      console.error('‚ùå Backend no disponible:', e);
    });
};

// Ejecutar verificaci√≥n simple
verificarBackend();
```

================================================================================
üéØ TESTING AVANZADO
================================================================================

üß™ TEST DE DIFERENTES CONFIGURACIONES:

```javascript
const testCompleto = () => {
  const configuraciones = [
    { umbral: '60.0', ia: 'false', nombre: 'Simulaci√≥n Flexible' },
    { umbral: '70.0', ia: 'false', nombre: 'Simulaci√≥n Normal' },
    { umbral: '80.0', ia: 'false', nombre: 'Simulaci√≥n Estricta' },
    { umbral: '70.0', ia: 'true', nombre: 'IA Real' }
  ];
  
  const input = document.createElement('input');
  input.type = 'file';
  input.accept = 'image/*';
  
  input.onchange = async (event) => {
    const archivo = event.target.files[0];
    if (!archivo) return;
    
    console.log('üß™ Probando todas las configuraciones...');
    
    for (const config of configuraciones) {
      const formData = new FormData();
      formData.append('foto_verificacion', archivo);
      formData.append('umbral_confianza', config.umbral);
      formData.append('buscar_en', 'propietarios');
      formData.append('usar_ia_real', config.ia);
      
      console.log(`üîÑ Probando: ${config.nombre}`);
      
      try {
        const response = await fetch('http://127.0.0.1:8000/api/seguridad/verificacion-tiempo-real/', {
          method: 'POST',
          body: formData
        });
        
        const data = await response.json();
        console.log(`‚úÖ ${config.nombre}:`, data.verificacion.resultado, `(${data.verificacion.confianza.toFixed(1)}%)`);
      } catch (error) {
        console.log(`‚ùå ${config.nombre}: Error`);
      }
    }
  };
  
  input.click();
};

// Ejecutar test completo
testCompleto();
```

================================================================================
üìÅ ARCHIVOS DE LOG
================================================================================

Para guardar resultados de pruebas:

```javascript
const guardarResultados = (data) => {
  const resultado = {
    timestamp: new Date().toISOString(),
    resultado: data
  };
  
  const blob = new Blob([JSON.stringify(resultado, null, 2)], 
    { type: 'application/json' });
  const url = URL.createObjectURL(blob);
  
  const a = document.createElement('a');
  a.href = url;
  a.download = `prueba_reconocimiento_${Date.now()}.json`;
  a.click();
  
  console.log('üíæ Resultado guardado en archivo JSON');
};
```

================================================================================
‚úÖ CHECKLIST DE PRUEBAS
================================================================================

‚òëÔ∏è Backend Django corriendo en puerto 8000
‚òëÔ∏è Test 1: Conexi√≥n b√°sica (dashboard) - Status 200
‚òëÔ∏è Test 2: Endpoint reconocimiento - Status 405 para GET
‚òëÔ∏è Test 3: Prueba con imagen (simulaci√≥n) - Resultado exitoso
‚òëÔ∏è Test 4: Prueba con IA real - Funciona (m√°s lento)
‚òëÔ∏è Test 5: Diferentes configuraciones - Todos funcionan
‚òëÔ∏è Test 6: Manejo de errores - Respuestas correctas

üéØ SI TODOS LOS TESTS PASAN = SISTEMA LISTO PARA PRODUCCI√ìN

================================================================================
üìû AYUDA ADICIONAL
================================================================================

Si alg√∫n test falla:

1. üîç Revisar consola del navegador para errores detallados
2. üìã Verificar que el mensaje de error coincida con las soluciones
3. üîÑ Reiniciar el servidor Django si es necesario
4. üåê Probar en modo inc√≥gnito del navegador
5. üì± Probar en diferente navegador (Chrome, Edge, Firefox)

üî• ¬°LISTO PARA PROBAR EL SISTEMA COMPLETO! üî•