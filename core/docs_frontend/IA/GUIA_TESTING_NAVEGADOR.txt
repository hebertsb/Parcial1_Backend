================================================================================
ğŸŒ GUÃA COMPLETA PARA PROBAR EL RECONOCIMIENTO FACIAL EN EL NAVEGADOR
================================================================================

ğŸ“‹ INSTRUCCIONES PASO A PASO PARA TESTING EN NAVEGADOR WEB

================================================================================
ğŸš€ PASO 1: PREPARAR EL ENTORNO
================================================================================

1. âœ… VERIFICAR QUE EL BACKEND ESTÃ‰ CORRIENDO:
   - Abrir PowerShell en: D:\UNIVERSIDAD_AUTONOMA_GABRIEL_RENE_MORENO\MATERIAS\Sistema_de_Informacion_II\1er_Parcial\backendParcial1
   - Ejecutar: python manage.py runserver
   - Verificar que aparezca: "Starting development server at http://127.0.0.1:8000/"

2. âœ… VERIFICAR CONEXIÃ“N BÃSICA:
   - Abrir navegador (Chrome/Edge/Firefox)
   - Ir a: http://127.0.0.1:8000/admin/
   - Si carga la pÃ¡gina de admin de Django = âœ… Backend OK

================================================================================
ğŸ” PASO 2: PRUEBAS BÃSICAS DE CONEXIÃ“N (CONSOLA DEL NAVEGADOR)
================================================================================

1. ğŸ“± ABRIR CONSOLA DEL NAVEGADOR:
   - Presionar F12 o Clic derecho â†’ Inspeccionar
   - Ir a la pestaÃ±a "Console" / "Consola"

2. ğŸ§ª TEST 1 - CONEXIÃ“N BACKEND:
   
   Copiar y pegar en la consola:
   ```javascript
   // Test bÃ¡sico de conexiÃ³n backend (OpciÃ³n 1: Admin Django)
   fetch('http://127.0.0.1:8000/admin/')
     .then(r => {
       console.log('âœ… Backend Status:', r.status);
       if (r.status === 200) {
         console.log('ğŸ¯ Backend Django funcionando correctamente!');
         console.log('ğŸ“¡ Django Admin pÃ¡gina cargada');
       }
       return r.text();
     })
     .then(html => {
       if (html.includes('Django')) {
         console.log('âœ… Confirmado: Django estÃ¡ corriendo');
       }
     })
     .catch(e => {
       console.error('âŒ Error conexiÃ³n backend:', e);
       console.log('ğŸ’¡ Verificar que Django estÃ© corriendo');
     });
   ```

   **ğŸ†• OPCIÃ“N ALTERNATIVA - HEALTH CHECK API:**
   ```javascript
   // Test de conexiÃ³n usando Health Check API (sin autenticaciÃ³n)
   fetch('http://127.0.0.1:8000/api/seguridad/health/')
     .then(r => {
       console.log('ğŸ” Health Check Status:', r.status);
       return r.json();
     })
     .then(data => {
       if (data.success) {
         console.log('âœ… Backend funcionando correctamente!');
         console.log('ğŸ“¡ Estado:', data.status);
         console.log('ğŸ• Timestamp:', data.timestamp);
         console.log('ğŸ“¦ VersiÃ³n:', data.version);
       }
     })
     .catch(e => {
       console.error('âŒ Error conexiÃ³n health check:', e);
       console.log('ğŸ’¡ Verificar que Django estÃ© corriendo');
     });
   ```

   RESULTADO ESPERADO:
   - âœ… Backend Status: 200
   - ğŸ¯ Backend Django funcionando correctamente!
   - âœ… Confirmado: Django estÃ¡ corriendo

3. ğŸ§ª TEST 2 - ENDPOINT RECONOCIMIENTO FACIAL:
   
   Copiar y pegar en la consola:
   ```javascript
   // Test del endpoint de reconocimiento facial
   fetch('http://127.0.0.1:8000/seguridad/reconocimiento-facial/', {
     method: 'POST',
     headers: {
       'Content-Type': 'application/json',
     },
     body: JSON.stringify({
       imagen: 'data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wBDAAYEBQYFBAYGBQYHBwYIChAKCgkJChQODwwQFxQYGBcUFhYaHSUfGhsjHBYWICwgIyYnKSopGR8tMC0oMCUoKSj/2wBDAQcHBwoIChMKChMoGhYaKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCj/wAARCAABAAEDASIAAhEBAxEB/8QAFQABAQAAAAAAAAAAAAAAAAAAAAv/xAAUEAEAAAAAAAAAAAAAAAAAAAAA/8QAFQEBAQAAAAAAAAAAAAAAAAAAAAX/xAAUEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwCdABmX/9k='
     })
   })
   .then(r => {
     console.log('ğŸ“¡ Endpoint Status:', r.status);
     if (r.status === 200) {
       console.log('âœ… Endpoint funcionando correctamente');
       console.log('ğŸ¯ Listo para recibir fotos reales');
     } else if (r.status === 400) {
       console.log('âœ… Endpoint existe (400 = imagen invÃ¡lida, normal)');
       console.log('ğŸ¯ Listo para recibir fotos reales');
     }
     return r.json();
   })
   .then(data => {
     console.log('ğŸ“‹ Response:', data);
   })
   .catch(e => console.error('âŒ Error endpoint:', e));
   ```

   RESULTADO ESPERADO:
   - ğŸ“¡ Endpoint Status: 200 o 400
   - âœ… Endpoint funcionando correctamente
   - ğŸ¯ Listo para recibir fotos reales

================================================================================
ğŸ–¼ï¸ PASO 3: PRUEBA CON IMAGEN REAL
================================================================================

1. ğŸ“· PREPARAR UNA IMAGEN:
   - Tener lista una foto en tu computadora
   - Preferiblemente una foto de rostro clara
   - TamaÃ±o menor a 5MB
   - Formato: JPG, PNG, WEBP

2. ğŸ§ª TEST 3 - CREAR Y PROBAR CON IMAGEN:
   
   Copiar y pegar en la consola:
   ```javascript
   // FunciÃ³n para probar con imagen
   const probarReconocimientoFacial = () => {
     // Crear input de archivo
     const input = document.createElement('input');
     input.type = 'file';
     input.accept = 'image/*';
     
     input.onchange = (event) => {
       const archivo = event.target.files[0];
       if (!archivo) return;
       
       console.log('ğŸ“‚ Archivo seleccionado:', archivo.name);
       console.log('ğŸ“ TamaÃ±o:', (archivo.size / 1024 / 1024).toFixed(2), 'MB');
       
       // Crear FormData
       const formData = new FormData();
       formData.append('foto_verificacion', archivo);
       formData.append('umbral_confianza', '70.0');
       formData.append('buscar_en', 'propietarios');
       formData.append('usar_ia_real', 'false'); // Usar simulaciÃ³n primero
       
       console.log('ğŸš€ Enviando request...');
       console.log('â±ï¸ Esto puede tomar unos segundos...');
       
       // Hacer request
       fetch('http://127.0.0.1:8000/api/seguridad/verificacion-tiempo-real/', {
         method: 'POST',
         body: formData
       })
       .then(response => {
         console.log('ğŸ“¡ Status Code:', response.status);
         return response.json();
       })
       .then(data => {
         console.log('ğŸ¯ RESULTADO COMPLETO:', data);
         
         if (data.success) {
           if (data.verificacion.resultado === 'ACEPTADO') {
             console.log('âœ… ACCESO AUTORIZADO');
             console.log('ğŸ‘¤ Persona:', data.verificacion.persona_identificada.nombre_completo);
             console.log('ğŸ¯ Confianza:', data.verificacion.confianza.toFixed(1) + '%');
           } else {
             console.log('âŒ ACCESO DENEGADO');
             console.log('ğŸ“Š Confianza:', data.verificacion.confianza.toFixed(1) + '%');
           }
         } else {
           console.log('âš ï¸ ERROR:', data.error);
         }
       })
       .catch(error => {
         console.error('âŒ Error en request:', error);
       });
     };
     
     // Abrir selector de archivos
     input.click();
   };
   
   // Ejecutar funciÃ³n
   console.log('ğŸ“‚ Selecciona una imagen para probar...');
   probarReconocimientoFacial();
   ```

3. ğŸ“ QUÃ‰ HACER:
   - Ejecutar el cÃ³digo de arriba
   - Se abrirÃ¡ un selector de archivos
   - Elegir una imagen (foto de rostro)
   - Esperar el resultado en la consola

================================================================================
ğŸ§ª PASO 4: PRUEBA CON IA REAL
================================================================================

Si la prueba anterior funcionÃ³, probar con IA real:

```javascript
const probarConIA = () => {
  const input = document.createElement('input');
  input.type = 'file';
  input.accept = 'image/*';
  
  input.onchange = (event) => {
    const archivo = event.target.files[0];
    if (!archivo) return;
    
    const formData = new FormData();
    formData.append('foto_verificacion', archivo);
    formData.append('umbral_confianza', '70.0');
    formData.append('buscar_en', 'propietarios');
    formData.append('usar_ia_real', 'true'); // IA REAL
    
    console.log('ğŸ¤– Probando con IA REAL...');
    console.log('â±ï¸ Esto tomarÃ¡ mÃ¡s tiempo (hasta 30 segundos)...');
    
    const startTime = Date.now();
    
    fetch('http://127.0.0.1:8000/api/seguridad/verificacion-tiempo-real/', {
      method: 'POST',
      body: formData
    })
    .then(response => response.json())
    .then(data => {
      const tiempo = ((Date.now() - startTime) / 1000).toFixed(1);
      console.log('â±ï¸ Tiempo total:', tiempo, 'segundos');
      console.log('ğŸ¤– RESULTADO CON IA:', data);
    })
    .catch(error => console.error('âŒ Error IA:', error));
  };
  
  input.click();
};

// Ejecutar
probarConIA();
```

================================================================================
ğŸ“Š PASO 5: INTERPRETAR RESULTADOS
================================================================================

ğŸŸ¢ RESULTADO EXITOSO (ACCESO AUTORIZADO):
```json
{
  "success": true,
  "verificacion": {
    "resultado": "ACEPTADO",
    "persona_identificada": {
      "nombre_completo": "Luis GarcÃ­a",
      "documento": "12345678",
      "unidad": "Apto 101",
      "tipo_residente": "Propietario"
    },
    "confianza": 85.7,
    "umbral_usado": "70.0"
  },
  "estadisticas": {
    "total_comparaciones": 10,
    "tiempo_procesamiento_ms": 2340.5
  }
}
```

ğŸ”´ RESULTADO DENEGADO:
```json
{
  "success": true,
  "verificacion": {
    "resultado": "DENEGADO",
    "confianza": 45.2,
    "umbral_usado": "70.0"
  }
}
```

âŒ ERROR:
```json
{
  "success": false,
  "error": "DescripciÃ³n del error"
}
```

================================================================================
ğŸ”§ SOLUCIÃ“N A PROBLEMAS COMUNES
================================================================================

âŒ ERROR: "Failed to fetch" o "Network Error"
ğŸ’¡ SOLUCIÃ“N: 
   - Verificar que Django estÃ© corriendo
   - Usar exactamente http://127.0.0.1:8000 (no localhost)

âŒ ERROR: "CORS policy"
ğŸ’¡ SOLUCIÃ“N: 
   - El backend ya tiene CORS configurado
   - Verificar URL exacta del endpoint

âŒ ERROR: "400 Bad Request"
ğŸ’¡ SOLUCIÃ“N: 
   - Imagen muy grande (max 5MB)
   - Formato no vÃ¡lido (usar JPG/PNG)

âŒ ERROR: "Request timeout"
ğŸ’¡ SOLUCIÃ“N: 
   - Normal con IA real (hasta 30 segundos)
   - Probar primero con simulaciÃ³n

âŒ ERROR: "401 Unauthorized" en dashboard
ğŸ’¡ SOLUCIÃ“N: 
   - El endpoint /api/seguridad/dashboard/ requiere autenticaciÃ³n
   - Usar /api/seguridad/health/ para verificar conexiÃ³n (sin auth)
   - Si necesitas dashboard, primero hacer login con /authz/login/

================================================================================
ğŸ” SOLUCIÃ“N PARA ERROR 401 - AUTENTICACIÃ“N
================================================================================

Si recibes **401 Unauthorized** en el dashboard, usa este cÃ³digo:

ğŸ§ª **TEST: HEALTH CHECK SIN AUTENTICACIÃ“N**
```javascript
// Verificar backend sin autenticaciÃ³n
fetch('http://127.0.0.1:8000/api/seguridad/health/')
  .then(r => {
    console.log('ğŸ” Health Status:', r.status);
    return r.json();
  })
  .then(data => {
    console.log('âœ… Backend OK:', data.message);
    console.log('ğŸ“¡ Status:', data.status);
    console.log('ğŸ• Time:', data.timestamp);
  })
  .catch(e => console.error('âŒ Error:', e));
```

ğŸ§ª **TEST: LOGIN Y DASHBOARD COMPLETO**
```javascript
// FunciÃ³n para hacer login y acceder al dashboard
const loginYDashboard = async () => {
  try {
    // 1. Hacer login
    console.log('ğŸ” Haciendo login...');
    const loginResponse = await fetch('http://127.0.0.1:8000/authz/login/', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        username: 'tu_usuario',  // âš ï¸ CAMBIAR POR TU USUARIO
        password: 'tu_password'  // âš ï¸ CAMBIAR POR TU PASSWORD
      })
    });

    if (loginResponse.ok) {
      const loginData = await loginResponse.json();
      console.log('âœ… Login exitoso');
      
      // 2. Usar el token para acceder al dashboard
      const token = loginData.access_token || loginData.access;
      console.log('ğŸŸï¸ Token obtenido');
      
      const dashboardResponse = await fetch('http://127.0.0.1:8000/api/seguridad/dashboard/', {
        headers: {
          'Authorization': `Bearer ${token}`,
          'Content-Type': 'application/json'
        }
      });
      
      if (dashboardResponse.ok) {
        const dashboardData = await dashboardResponse.json();
        console.log('âœ… Dashboard accedido exitosamente');
        console.log('ğŸ“Š Datos:', dashboardData);
      } else {
        console.log('âŒ Error dashboard:', dashboardResponse.status);
      }
      
    } else {
      console.log('âŒ Error login:', loginResponse.status);
      const errorData = await loginResponse.json();
      console.log('ğŸ” Detalle error:', errorData);
    }
    
  } catch (error) {
    console.error('ğŸ’¥ Error completo:', error);
  }
};

// Ejecutar (cambiar usuario y password arriba)
loginYDashboard();
```

ğŸ§ª **TEST: VERIFICAR SOLO HEALTH CHECK**
```javascript
// OpciÃ³n simple - solo verificar que backend funcione
const verificarBackend = () => {
  fetch('http://127.0.0.1:8000/api/seguridad/health/')
    .then(r => r.json())
    .then(data => {
      if (data.success) {
        console.log('âœ… BACKEND FUNCIONANDO');
        console.log('ğŸ¯ Mensaje:', data.message);
        console.log('ğŸ“¡ Estado:', data.status);
        console.log('â° Hora:', data.timestamp);
        
        // El backend estÃ¡ OK, ahora puedes usar reconocimiento facial
        console.log('ğŸ­ Reconocimiento facial disponible en:');
        console.log('   ğŸ“¡ /api/seguridad/verificacion-tiempo-real/');
      }
    })
    .catch(e => {
      console.error('âŒ Backend no disponible:', e);
    });
};

// Ejecutar verificaciÃ³n simple
verificarBackend();
```

================================================================================
ğŸ¯ TESTING AVANZADO
================================================================================

ğŸ§ª TEST DE DIFERENTES CONFIGURACIONES:

```javascript
const testCompleto = () => {
  const configuraciones = [
    { umbral: '60.0', ia: 'false', nombre: 'SimulaciÃ³n Flexible' },
    { umbral: '70.0', ia: 'false', nombre: 'SimulaciÃ³n Normal' },
    { umbral: '80.0', ia: 'false', nombre: 'SimulaciÃ³n Estricta' },
    { umbral: '70.0', ia: 'true', nombre: 'IA Real' }
  ];
  
  const input = document.createElement('input');
  input.type = 'file';
  input.accept = 'image/*';
  
  input.onchange = async (event) => {
    const archivo = event.target.files[0];
    if (!archivo) return;
    
    console.log('ğŸ§ª Probando todas las configuraciones...');
    
    for (const config of configuraciones) {
      const formData = new FormData();
      formData.append('foto_verificacion', archivo);
      formData.append('umbral_confianza', config.umbral);
      formData.append('buscar_en', 'propietarios');
      formData.append('usar_ia_real', config.ia);
      
      console.log(`ğŸ”„ Probando: ${config.nombre}`);
      
      try {
        const response = await fetch('http://127.0.0.1:8000/api/seguridad/verificacion-tiempo-real/', {
          method: 'POST',
          body: formData
        });
        
        const data = await response.json();
        console.log(`âœ… ${config.nombre}:`, data.verificacion.resultado, `(${data.verificacion.confianza.toFixed(1)}%)`);
      } catch (error) {
        console.log(`âŒ ${config.nombre}: Error`);
      }
    }
  };
  
  input.click();
};

// Ejecutar test completo
testCompleto();
```

================================================================================
ğŸ“ ARCHIVOS DE LOG
================================================================================

Para guardar resultados de pruebas:

```javascript
const guardarResultados = (data) => {
  const resultado = {
    timestamp: new Date().toISOString(),
    resultado: data
  };
  
  const blob = new Blob([JSON.stringify(resultado, null, 2)], 
    { type: 'application/json' });
  const url = URL.createObjectURL(blob);
  
  const a = document.createElement('a');
  a.href = url;
  a.download = `prueba_reconocimiento_${Date.now()}.json`;
  a.click();
  
  console.log('ğŸ’¾ Resultado guardado en archivo JSON');
};
```

================================================================================
âœ… CHECKLIST DE PRUEBAS
================================================================================

â˜‘ï¸ Backend Django corriendo en puerto 8000
â˜‘ï¸ Test 1: ConexiÃ³n bÃ¡sica (dashboard) - Status 200
â˜‘ï¸ Test 2: Endpoint reconocimiento - Status 405 para GET
â˜‘ï¸ Test 3: Prueba con imagen (simulaciÃ³n) - Resultado exitoso
â˜‘ï¸ Test 4: Prueba con IA real - Funciona (mÃ¡s lento)
â˜‘ï¸ Test 5: Diferentes configuraciones - Todos funcionan
â˜‘ï¸ Test 6: Manejo de errores - Respuestas correctas

ğŸ¯ SI TODOS LOS TESTS PASAN = SISTEMA LISTO PARA PRODUCCIÃ“N

================================================================================
ğŸ“ AYUDA ADICIONAL
================================================================================

Si algÃºn test falla:

1. ğŸ” Revisar consola del navegador para errores detallados
2. ğŸ“‹ Verificar que el mensaje de error coincida con las soluciones
3. ğŸ”„ Reiniciar el servidor Django si es necesario
4. ğŸŒ Probar en modo incÃ³gnito del navegador
5. ğŸ“± Probar en diferente navegador (Chrome, Edge, Firefox)

ğŸ”¥ Â¡LISTO PARA PROBAR EL SISTEMA COMPLETO! ğŸ”¥